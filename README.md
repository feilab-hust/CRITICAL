## Test Data
If you want to test our code, Please download the corresponding folder of the code, which contains our testdata. We have uploaded our test data to google drive, along with the ImageJ software that can run our code: **<https://drive.google.com/drive/folders/1nCuSpTXkkto2ZSKuN_eA7z6JRkfVCyiA?usp=sharing>**  
The example images in the following text are from: "TestData\57-1_LKB1-10W-2(1.26X)-20221120\488-40ms-5um-1.26X-lobe1".

# TumorSegment   (ImageJ Macrocode)

### Flowchart
<p align="center">
<img src="./images/TumorSegment.png" alt="TumorSegment" height="300">
</p>

The algorithm is used to segment tumors in the lung lobes of mice and obtain information about the number, size and location of tumors. Prior to this, our data had been simply preprocessed.

### Usage:
Run this code directly through ImageJ. After running, select the "TestData" folder in "Choose the parent directory", and the macro code will run automatically. The path format for the data needs to be the same as our "TumorSegment_testdata". The code automatically recognizes ***stack.tif*** in the subfolder for processing, ***stack_Merge_v5.tif*** is the processed image result, and the ***.csv*** file is the processed statistics result.

### Example images
<p align="center">
<img src="./images/stack.png" alt="stack.tif" height="250"> <img src="./images/stack_Merge_v5.png" alt="stack_Merge_v5.tif" height="250"> <img src="./images/csv.png" alt="*.csv" height="200">
</p>

# Surface_tumor   (Matlab)

### Flowchart
<p align="center">
<img src="./images/Surface_tumor.png" alt="Surface_tumor" height="300">
</p>

The algorithm is used to analyze the distribution of tumors within the mouse lung lobes. Specifically, it calculates the shortest distance from each tumor to the surface of the lung lobe.

### Usage:
1、Segment the mouse lung lobe image to obtain the binary image ***lung_space.tif***. This process can be quickly and accurately completed using the *"Labkit"* plugin in ImageJ.  
<p align="center">
<img src="./images/Labkit.png" alt="Labkit plugin" height="150">
</p>

2、It is usually necessary to run the **img_processing.m** program to optimize the segmented mask, resulting in ***lung_space_improve.tif***.  
3、Extract the tumor segmentation channel (green channel) from the ***stack_Merge_v5.tif*** image generated by **TumorSegment.ijm** and save it as the ***tumor.tif*** image.  
4、Use ***lung_space_improve.tif***, ***tumor.tif***, and the ***.csv*** statistical table as input to run the **surface_tumor.m** program. The program will generate a new XLSX file, where the distance information for each tumor will be automatically recorded in the first column of the table.

### Example images
<p align="center">
<img src="./images/lung_space.png" alt="lung_space.tif" height="250"> <img src="./images/lung_space_improve.png" alt="lung_space_improve.tif" height="250"> <img src="./images/tumor.png" alt="tumor.tif" height="250"> <img src="./images/xlsx.png" alt="*.xlsx" height="200">
</p>

# ResNet3D_tumor_classification   (Python)

### Network Architecture
<p align="center">
<img src="./images/ResNet.png" alt="ResNet" height="300">
</p>

The algorithm is primarily used for the automatic classification of tumors in mouse lung lobes. We classify the tumors into three types: atypical adenomatous hyperplasia (AAH), adenoma (AD), and adenocarcinoma (AC). Based on the statistical results from the **TumorSegment.ijm** algorithm, we crop the original lung lobe images to obtain individual tumor images(**crop_tumor_LorR.m**). After expert diagnosis, we obtained labels for nearly 2,000 tumors. Our algorithm is based on a 3D ResNet18 deep learning model, which achieves an accuracy of 93% on the test dataset.

### Installation
Run the following code to install all dependencies: `conda env create -f environment.yml`

### Usage:
**"main.py"** is used to train the model, while **"predict_AAH_AD_AC.py"** is used for tumor classification.   
Due to the nature of the dataset and labels, we performed two binary classifications to accomplish the three-class task. First, we classify AAH versus AD/AC, and then we classify AD versus AC. Therefore, we provide two **".pth"** pre-trained parameter files.

### The experimental results of the test dataset will be updated later……
